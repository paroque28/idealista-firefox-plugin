<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Idealista AI Assistant</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container">
    <header>
      <h1>Idealista AI Assistant</h1>
      <p class="subtitle">Powered by Claude</p>
    </header>

    <main>
      <section class="api-key-section">
        <h2>Claude API Key</h2>

        <div class="input-group">
          <input
            type="password"
            id="apiKey"
            placeholder="sk-ant-api03-..."
            autocomplete="off"
          >
          <button id="toggleVisibility" class="btn-icon" title="Toggle visibility">
            <span class="eye-icon">üëÅ</span>
          </button>
        </div>

        <div id="status" class="status"></div>

        <button id="saveKey" class="btn btn-primary">
          Save API Key
        </button>

        <button id="clearKey" class="btn btn-secondary">
          Clear API Key
        </button>
      </section>

      <section class="help-section">
        <h2>How to Get an API Key</h2>
        <ol>
          <li>
            <strong>Create Account:</strong>
            Go to <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a>
          </li>
          <li>
            <strong>Add Credits:</strong>
            Settings ‚Üí Billing ‚Üí Add payment method
          </li>
          <li>
            <strong>Create Key:</strong>
            Settings ‚Üí API Keys ‚Üí Create Key
          </li>
          <li>
            <strong>Copy Key:</strong>
            Starts with <code>sk-ant-api03-...</code>
          </li>
        </ol>
        <p class="cost-note">
          üí° Cost: ~$3/million tokens (~cents per session)
        </p>
      </section>

      <section class="usage-section">
        <h2>How to Use</h2>
        <ol>
          <li>Save your API key above</li>
          <li>Go to any Idealista search page</li>
          <li>Click the ü§ñ button (bottom-right)</li>
          <li>Chat with Claude to filter listings!</li>
        </ol>
      </section>

      <section class="profile-section">
        <h2>Tu Perfil (para mensajes)</h2>
        <p class="section-description">Esta informaci√≥n ayuda a Claude a escribir mensajes personalizados.</p>

        <div class="profile-field">
          <label for="profileName">Nombre</label>
          <input type="text" id="profileName" placeholder="Pablo">
        </div>

        <div class="profile-field">
          <label for="profileSituation">Situaci√≥n</label>
          <input type="text" id="profileSituation" placeholder="Pareja joven, trabajamos en tech">
        </div>

        <div class="profile-field">
          <label for="profileIncome">Ingresos mensuales</label>
          <input type="text" id="profileIncome" placeholder="5000‚Ç¨ netos">
        </div>

        <div class="profile-field">
          <label for="profilePets">Mascotas</label>
          <input type="text" id="profilePets" placeholder="No tenemos mascotas">
        </div>

        <div class="profile-field">
          <label for="profilePreferences">Preferencias de b√∫squeda</label>
          <textarea id="profilePreferences" rows="2" placeholder="Piso luminoso, tranquilo, cerca del metro..."></textarea>
        </div>

        <div class="profile-field">
          <label for="profileFlexibility">Flexibilidad de fechas</label>
          <textarea id="profileFlexibility" rows="2" placeholder="Podemos entrar a partir del 1 de marzo..."></textarea>
        </div>

        <div class="profile-field">
          <label for="profileTemporalReason">Raz√≥n para alquiler temporal (si aplica)</label>
          <textarea id="profileTemporalReason" rows="2" placeholder="Ej: Proyecto laboral de 6 meses, m√°ster de 10 meses, reforma en casa..."></textarea>
          <p class="field-hint">Solo si tienes una raz√≥n REAL y demostrable. D√©jalo vac√≠o si no.</p>
        </div>

        <div class="profile-field">
          <label for="profileNotes">Notas adicionales</label>
          <textarea id="profileNotes" rows="2" placeholder="Cualquier otra informaci√≥n relevante..."></textarea>
        </div>

        <div class="profile-field">
          <label for="profileMarketContext">Contexto del mercado (para Claude)</label>
          <textarea id="profileMarketContext" rows="6" placeholder="Reglas y contexto del mercado inmobiliario..."></textarea>
          <p class="field-hint">Instrucciones que Claude seguir√° al generar mensajes</p>
        </div>

        <button id="loadDefaultContext" class="btn btn-secondary">
          Cargar contexto Espa√±a/Catalunya
        </button>

        <button id="saveProfile" class="btn btn-primary">
          Guardar Perfil
        </button>

        <div id="profileStatus" class="status"></div>
      </section>

      <section class="memories-section">
        <h2>Memorias</h2>
        <p class="section-description">Informaci√≥n que Claude recordar√° entre sesiones.</p>
        <div id="memoriesList" class="memories-list"></div>
        <div class="memories-input">
          <input type="text" id="newMemory" placeholder="A√±adir memoria (ej: Me gusta cocinar)">
          <button id="addMemory" class="btn-icon" title="A√±adir">+</button>
        </div>
      </section>
    </main>

    <footer>
      <p>Version 1.0.0 ¬∑ <a href="https://github.com/paroque28/idealista-firefox-plugin" target="_blank">GitHub</a></p>
    </footer>
  </div>

  <script src="browser-polyfill.js"></script>
  <script src="popup.js"></script>
</body>
</html>
